<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galactic Piano Interattivo</title>
<style>
body { margin:0; overflow:hidden; background:#000; font-family:sans-serif; }
canvas { display:block; position:absolute; top:0; left:0; width:100%; height:100%; }
h1 { position:absolute; top:20px; width:100%; text-align:center; color:#00ffdd; font-size:2em; text-shadow:0 0 15px #00ffdd; }
</style>
</head>
<body>
<h1>Premi tasti o clicca: esplode lâ€™universo!</h1>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];
const shapes = ['circle','star','triangle'];
const colors = ['#00ffdd','#ff00ff','#ffff00','#00ff00','#ff0000','#ff7700','#00ffff','#ff00aa'];
let keysPressed = {};

class Particle {
  constructor(x,y,color,shape){
    this.x = x; this.y = y;
    this.radius = Math.random()*8+5;
    this.color = color;
    this.shape = shape;
    this.vx = (Math.random()-0.5)*6;
    this.vy = (Math.random()-0.5)*6;
    this.alpha = 1;
    this.angle = Math.random()*360;
  }
  update(){
    this.x += this.vx;
    this.y += this.vy;
    this.alpha -= 0.02;
    this.angle += 5;
  }
  draw(){
    ctx.save();
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = this.color;
    ctx.translate(this.x,this.y);
    ctx.rotate(this.angle*Math.PI/180);
    if(this.shape==='circle'){
      ctx.beginPath();
      ctx.arc(0,0,this.radius,0,Math.PI*2);
      ctx.fill();
    } else if(this.shape==='star'){
      ctx.beginPath();
      for(let i=0;i<5;i++){
        ctx.lineTo(Math.cos((i*144)*Math.PI/180)*this.radius, Math.sin((i*144)*Math.PI/180)*this.radius);
      }
      ctx.closePath();
      ctx.fill();
    } else {
      ctx.beginPath();
      for(let i=0;i<3;i++){
        ctx.lineTo(Math.cos((i*120)*Math.PI/180)*this.radius, Math.sin((i*120)*Math.PI/180)*this.radius);
      }
      ctx.closePath();
      ctx.fill();
    }
    ctx.restore();
  }
}

function spawnParticles(x,y,count=30){
  for(let i=0;i<count;i++){
    let color = colors[Math.floor(Math.random()*colors.length)];
    let shape = shapes[Math.floor(Math.random()*shapes.length)];
    particles.push(new Particle(x,y,color,shape));
  }
}

function animate(){
  // Sfondo galassia dinamico
  let t = Date.now()*0.001;
  let gradient = ctx.createRadialGradient(canvas.width/2,canvas.height/2,0,canvas.width/2,canvas.height/2,canvas.width/2);
  gradient.addColorStop(0,'hsl(' + ((t*40)%360) + ',100%,5%)');
  gradient.addColorStop(1,'#000');
  ctx.fillStyle = gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let i=particles.length-1;i>=0;i--){
    particles[i].update();
    particles[i].draw();
    if(particles[i].alpha<=0) particles.splice(i,1);
  }
  requestAnimationFrame(animate);
}
animate();

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const notes = {
  'a':261.63,'s':293.66,'d':329.63,'f':349.23,'g':392.00,
  'h':440.00,'j':493.88,'k':523.25
};

function playTone(freq){
  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  oscillator.type = 'sawtooth';
  oscillator.frequency.value = freq;
  gainNode.gain.setValueAtTime(0.5,audioCtx.currentTime);
  oscillator.start();
  oscillator.stop(audioCtx.currentTime + 0.3);
}

function triggerEffect(x,y){
  let combo = Object.keys(keysPressed).filter(k=>keysPressed[k]);
  let count = combo.length>=2 ? 80 : 30;
  spawnParticles(x,y,count);
}

window.addEventListener('keydown', e=>{
  if(notes[e.key]){
    keysPressed[e.key] = true;
    playTone(notes[e.key]);
    triggerEffect(Math.random()*canvas.width, Math.random()*canvas.height);
  }
});

window.addEventListener('keyup', e=>{
  if(notes[e.key]) keysPressed[e.key] = false;
});

canvas.addEventListener('mousemove', e=>{
  spawnParticles(e.clientX, e.clientY, 2);
});

canvas.addEventListener('click', e=>{
  triggerEffect(e.clientX, e.clientY);
  const keys = Object.keys(notes);
  const note = notes[keys[Math.floor(Math.random()*keys.length)]];
  playTone(note);
});
</script>
</body>
</html>
